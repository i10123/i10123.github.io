<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Naval Warfare 2077</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="ocean-bg"><div class="wave"></div><div class="wave"></div></div>

    <!-- 1. LANGUAGE SCREEN -->
    <div id="screen-language" class="screen active">
        <div class="flex flex-col items-center justify-center min-h-screen p-6">
            <h1 class="text-5xl font-black orbitron text-cyan-400 mb-8 text-center neon-text">NAVAL<br>WARFARE</h1>
            <div class="w-full max-w-sm space-y-4">
                <button onclick="setLanguage('en')" class="w-full glass rounded-2xl p-6 flex items-center gap-4 active:scale-95 transition">
                    <span class="text-4xl">üá¨üáß</span> <span class="text-2xl font-bold">English</span>
                </button>
                <button onclick="setLanguage('ru')" class="w-full glass rounded-2xl p-6 flex items-center gap-4 active:scale-95 transition">
                    <span class="text-4xl">üá∑üá∫</span> <span class="text-2xl font-bold">–†—É—Å—Å–∫–∏–π</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2. REGISTER SCREEN -->
    <div id="screen-register" class="screen">
        <div class="flex flex-col items-center justify-center min-h-screen p-6">
            <button type="button" onclick="showScreen('screen-language')" class="btn-back self-start mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <div class="glass rounded-3xl p-8 w-full max-w-md">
                <h2 class="text-2xl font-bold orbitron text-cyan-400 mb-2" data-key="welcome">Welcome</h2>
                <label for="input-nickname"></label>
                <input id="input-nickname" type="text" data-key="nick_placeholder" placeholder="Nickname..." class="w-full bg-black/50 border border-cyan-400/50 rounded-xl px-4 py-3 text-white mb-4 outline-none focus:border-cyan-400">
                <button id="btn-register" class="w-full btn-primary rounded-xl py-4 font-bold text-lg orbitron" data-key="deploy">DEPLOY</button>
            </div>
        </div>
    </div>

    <!-- 3. LOBBY / DASHBOARD -->
    <div id="screen-dashboard" class="screen">
        <div class="p-4 pb-24 min-h-screen">
            <div class="flex items-center gap-2 mb-4">
                <button type="button" onclick="showScreen('screen-language')" class="btn-back text-cyan-400 text-sm font-medium flex items-center gap-1">
                    <span aria-hidden="true">‚Üê</span> <span data-key="back">Back</span>
                </button>
            </div>
            <div class="flex justify-between items-center mb-6 pt-2">
                <div>
                    <h1 class="text-2xl font-bold orbitron text-cyan-400">COMMAND</h1>
                    <p id="user-display-name" class="text-sm opacity-70">Cadet</p>
                </div>
                <button onclick="showScreen('screen-settings')" class="glass p-2 rounded-lg text-cyan-400"><iconify-icon icon="lucide:settings" width="24"></iconify-icon></button>
            </div>

            <div class="glass rounded-2xl p-4 mb-6 flex justify-around text-center">
                <div><div class="text-2xl font-bold text-yellow-400" id="dash-coins">0</div><div class="text-xs opacity-60">Coins</div></div>
                <div><div class="text-2xl font-bold text-green-400" id="dash-wins">0</div><div class="text-xs opacity-60">Wins</div></div>
                <div><div class="text-2xl font-bold text-pink-400" id="dash-winrate">0%</div><div class="text-xs opacity-60">WinRate</div></div>
            </div>

            <div class="space-y-3">
                <button onclick="createBattle()" class="w-full btn-primary rounded-2xl py-5 font-bold text-lg flex items-center justify-center gap-3">
                    <iconify-icon icon="lucide:swords" width="24"></iconify-icon> <span data-key="create_battle">CREATE BATTLE</span>
                </button>
                <div id="game-link-area" class="hidden glass p-4 rounded-xl text-center">
                    <p class="text-xs mb-2 text-cyan-400">Send this link to friend:</p>
                    <label for="share-link-input"></label>
                    <input id="share-link-input" readonly class="w-full bg-black/50 text-xs p-2 rounded mb-2 border border-cyan-500/30">
                    <button onclick="copyGameLink()" class="btn-secondary px-4 py-1 rounded text-xs">COPY</button>
                </div>

                <button onclick="showScreen('screen-shop')" class="w-full btn-secondary rounded-2xl py-4 font-bold flex items-center justify-center gap-3">
                    <iconify-icon icon="lucide:shopping-bag" width="20"></iconify-icon> <span data-key="shop">SHOP</span>
                </button>
            </div>

            <button id="admin-btn" onclick="showScreen('screen-admin')" class="hidden w-full mt-4 border border-red-500/50 text-red-400 py-2 rounded-xl text-xs">ADMIN PANEL</button>
        </div>
    </div>

    <!-- 4. PLACEMENT SCREEN -->
    <div id="screen-placement" class="screen">
        <div class="p-4 min-h-screen flex flex-col">
            <button type="button" onclick="showScreen('screen-dashboard')" class="btn-back self-start mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-cyan-400" data-key="deploy_fleet">Deploy Fleet</h2>
                <button onclick="rotateShip()" class="glass p-2 rounded text-cyan-400"><iconify-icon icon="lucide:rotate-cw"></iconify-icon></button>
            </div>

            <div class="glass rounded-2xl p-2 mb-4">
                <div id="placement-grid" class="ship-grid"></div>
            </div>

            <div class="glass rounded-xl p-4 mb-4">
                <p class="text-sm mb-2" data-key="select_ship">Select Ship:</p>
                <div class="flex gap-2 justify-center" id="ship-selector"></div>
            </div>

            <button id="btn-ready" disabled onclick="confirmPlacement()" class="mt-auto w-full btn-primary rounded-xl py-4 font-bold text-black opacity-50 transition" data-key="ready">READY</button>
        </div>
    </div>

    <!-- 5. BATTLE SCREEN -->
    <div id="screen-battle" class="screen">
        <div class="p-4 min-h-screen flex flex-col">
            <button type="button" onclick="showScreen('screen-dashboard')" class="btn-back self-start mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <div class="flex justify-between items-center mb-4 glass p-2 rounded-xl">
                <div class="text-center w-1/3">
                    <div class="text-xs text-gray-400">YOU</div>
                    <div class="font-bold text-cyan-400" id="my-status">ALIVE</div>
                </div>
                <div class="text-center w-1/3 text-2xl font-bold text-white" id="battle-timer">10</div>
                <div class="text-center w-1/3">
                    <div class="text-xs text-gray-400">ENEMY</div>
                    <div class="font-bold text-pink-400" id="enemy-status">ALIVE</div>
                </div>
            </div>

            <div class="text-center mb-2 text-sm font-bold" id="turn-indicator">WAITING...</div>

            <div class="glass rounded-2xl p-2 mb-4 relative">
                <div class="absolute -top-3 left-2 text-xs bg-black px-2 text-pink-500">ENEMY WATERS</div>
                <div id="enemy-grid" class="ship-grid"></div>
            </div>

            <div class="glass rounded-2xl p-2 mt-auto relative opacity-80 scale-90">
                <div class="absolute -top-3 left-2 text-xs bg-black px-2 text-cyan-500">YOUR FLEET</div>
                <div id="my-grid" class="ship-grid"></div>
            </div>
        </div>
    </div>

    <!-- 6. ADMIN SCREEN -->
    <div id="screen-admin" class="screen">
        <div class="p-4">
            <button type="button" onclick="showScreen('screen-dashboard')" class="btn-back mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-red-400">ADMIN</h2>
            </div>
            <div class="space-y-3">
                <div class="glass p-4 rounded-xl">
                    <p>Active Games: <span id="admin-active-games" class="font-bold">0</span></p>
                </div>
                <div class="glass p-4 rounded-xl">
                    <label for="admin-user-id"></label>
                    <input id="admin-user-id" placeholder="User ID" class="bg-black/50 border border-white/20 p-2 rounded w-full mb-2">
                    <label for="admin-amount"></label>
                    <input id="admin-amount" type="number" placeholder="Amount" class="bg-black/50 border border-white/20 p-2 rounded w-full mb-2">
                    <div class="flex gap-2">
                        <button onclick="adminAddCurrency('coins')" class="flex-1 btn-secondary p-2 rounded">Add Coins</button>
                        <button onclick="adminAddCurrency('gems')" class="flex-1 btn-secondary p-2 rounded">Add Gems</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. SHOP & SETTINGS -->
    <div id="screen-shop" class="screen">
        <div class="p-4">
            <button type="button" onclick="showScreen('screen-dashboard')" class="btn-back mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <h1 class="text-2xl font-bold mb-4 text-yellow-400">PREMIUM SHOP</h1>
            <div class="glass p-4 rounded-xl mb-4 border border-yellow-500/30">
                <h3 class="font-bold text-lg text-yellow-300">VIP STATUS</h3>
                <p class="text-xs text-gray-300 mb-2">2x Coins, Golden Name</p>
                <button class="w-full btn-primary rounded p-2">BUY (500 Gems)</button>
            </div>
            <div class="glass p-4 rounded-xl mb-4">
                <h3 class="font-bold text-lg text-cyan-300">100 GEMS</h3>
                <button class="w-full btn-secondary rounded p-2 mt-2">BUY ($0.99)</button>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <div class="p-4">
            <button type="button" onclick="showScreen('screen-dashboard')" class="btn-back mb-4 text-cyan-400 text-sm font-medium">‚Üê <span data-key="back">Back</span></button>
            <h1 class="text-2xl font-bold mb-6">SETTINGS</h1>
            <button onclick="setLanguage('en')" class="w-full glass p-4 mb-2 text-left">üá¨üáß English</button>
            <button onclick="setLanguage('ru')" class="w-full glass p-4 mb-2 text-left">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        (function() {
            setTimeout(function() {
                if (typeof window.showScreen !== 'function') {
                    window.showScreen = function(id) {
                        document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
                        var el = document.getElementById(id && id.indexOf('screen-') === 0 ? id : 'screen-' + id);
                        if (el) el.classList.add('active');
                    };
                }
                if (typeof window.createBattle !== 'function') {
                    window.createBattle = function() { alert('App is loading... Reload the page.'); };
                }
                if (typeof window.setLanguage !== 'function') {
                    window.setLanguage = function() { alert('App is loading... Reload the page.'); };
                }
            }, 2000);
        })();
    </script>
</body>
</html>
