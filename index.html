<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; margin: 0; background: #f4f4f9; user-select: none; }
        .grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 2px; max-width: 350px; margin: 20px auto; background: #ccc; border: 2px solid #333; }
        .cell { aspect-ratio: 1; background: white; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; }
        .cell.hit { background: #ff4d4d; color: white; } /* –ü–æ–ø–∞–ª */
        .cell.miss { background: #b3e5fc; } /* –ü—Ä–æ–º–∞—Ö */
        #status { margin-top: 20px; font-weight: bold; color: #333; }
        .info { font-size: 12px; color: #666; padding: 10px; }
    </style>
</head>
<body>

    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    <div class="grid" id="board"></div>
    <div class="info">–û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å –≤–º–µ—Å—Ç–µ</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // –ö–û–ù–§–ò–ì FIREBASE (–í—Å—Ç–∞–≤—å —Å–≤–æ–π!)
        const firebaseConfig = {
          apiKey: "AIzaSyBzu_EqbYoHR9AGRjNTjlCX2f4seIMgpwk",
          authDomain: "test-game-bf099.firebaseapp.com",
          databaseURL: "https://test-game-bf099-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "test-game-bf099",
          storageBucket: "test-game-bf099.firebasestorage.app",
          messagingSenderId: "624705252854",
          appId: "1:624705252854:web:f24eb7255da54c47902bd7",
          measurementId: "G-TVDRXT9CHV"
    };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. –û–ü–†–ï–î–ï–õ–Ø–ï–ú –ö–û–ú–ù–ê–¢–£
        // Telegram –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ startapp –≤ initDataUnsafe
        const tg = window.Telegram.WebApp;
        const urlParams = new URLSearchParams(tg.initDataUnsafe.start_param || "");
        const roomId = tg.initDataUnsafe.start_param || "default_room";
        const gameRef = ref(db, `games/${roomId}`);

        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('status');

        // 2. –°–û–ó–î–ê–ï–ú –°–ï–¢–ö–£ 10x10
        for (let i = 0; i < 100; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;
            cell.onclick = () => makeShot(i);
            boardElement.appendChild(cell);
        }

        // 3. –§–£–ù–ö–¶–ò–Ø –í–´–°–¢–†–ï–õ–ê
        function makeShot(index) {
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –±–∞–∑—É: "–≤ –∫–æ–º–Ω–∞—Ç–µ —Ç–∞–∫–æ–π-—Ç–æ, –∫–ª–µ—Ç–∫–∞ ‚ÑñX —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å 'hit'"
            const updates = {};
            updates[`/shots/${index}`] = 'hit'; // –î–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–∫–∞ –≤—Å—ë –±—É–¥–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ–º
            update(gameRef, updates);
        }

        // 4. –°–õ–£–®–ê–ï–ú –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò–ì–†–´
        onValue(gameRef, (snapshot) => {
            const data = snapshot.val() || {};
            const shots = data.shots || {};

            statusElement.innerText = `–ö–æ–º–Ω–∞—Ç–∞: ${roomId}`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—Å–µ –∫–ª–µ—Ç–∫–∏
            document.querySelectorAll('.cell').forEach((cell, index) => {
                if (shots[index] === 'hit') {
                    cell.classList.add('hit');
                    cell.innerText = 'üí•';
                }
            });
        });

        tg.ready();
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    </script>
</body>
</html>
